!function(a){var b=function(){this.__super.constructor.apply(this,arguments),this.initLayout()};a.fn.slideprojector.registerImplementation(b,"poproll"),a.extend(b.prototype,{initLayout:function(){var b=0;this.viewportWidth=this.contentStripe.width(),this.prevViewportWidth=this.viewportWidth,this.sections=[[],[],[]],this.visibleWidth=0,this.popIndex=0,this.slideItems.each(function(c,d){var e=a(d),f=e.outerWidth(!0);e.data("cwidth",f),e.data("oversized",f>this.viewportWidth),e.data("visibleWidth",f>this.viewportWidth?0:f),e.data("oversized")&&e.hide(),c<this.currentIndex[0]?(e.hide(),this.sections[0].push(e)):(b+=e.data("visibleWidth"),b<this.viewportWidth?(this.sections[1].push(e),this.visibleWidth=this.visibleWidth+e.data("visibleWidth")):(this.sections[2].push(e),e.hide()))}.bind(this)),this.afterScroll(0),a(window).resize(this.onResize.bind(this))},beforeScroll:function(a){return this.sections[this.currentIndex[0]<a?2:0].length>0},performScroll:function(a){var b,c,d;if(this.currentIndex[0]<a){for(;this.sections[2].length&&this.sections[2][0].data("oversized");)this.sections[1].push(this.sections[2].shift());for(c=this.sections[2][0],this.visibleWidth+=c.data("cwidth"),this.sections[1].push(this.sections[2].shift()),d=this.sections[1][0];this.visibleWidth>this.viewportWidth;)b=this.sections[1][0],d=d.add(b),this.visibleWidth-=b.data("visibleWidth"),this.sections[0].push(this.sections[1].shift());for(b=this.sections[2][0];this.sections[2].length&&this.visibleWidth+b.data("visibleWidth")<=this.viewportWidth;)b.data("oversized")||(c=c.add(b)),this.visibleWidth+=b.data("visibleWidth"),this.sections[1].push(this.sections[2].shift()),b=this.sections[2][0]}else{for(;this.sections[0].length&&this.sections[0][this.sections[0].length-1].data("oversized");)this.sections[1].unshift(this.sections[0].pop());for(c=this.sections[0][this.sections[0].length-1],this.visibleWidth+=c.data("visibleWidth"),this.sections[1].unshift(this.sections[0].pop()),d=this.sections[1][this.sections[1].length-1];this.visibleWidth>this.viewportWidth;)b=this.sections[1][this.sections[1].length-1],d=d.add(b),this.visibleWidth-=b.data("visibleWidth"),this.sections[2].unshift(this.sections[1].pop());for(b=this.sections[0][this.sections[0].length-1];this.sections[0].length&&this.visibleWidth+b.data("visibleWidth")<=this.viewportWidth;)b.data("oversized")||(c=c.add(b)),this.visibleWidth+=b.data("visibleWidth"),this.sections[1].unshift(this.sections[0].pop()),b=this.sections[0][this.sections[0].length-1]}d.hide(this.options.duration),c.show(this.options.duration)},afterScroll:function(){this.currentIndex[0]=this.sections[0].length;var b=this.sections[0].length;a.each(this.sections[0],function(a,c){c.data("oversized")&&b--});var c=this.sections[2].length;a.each(this.sections[2],function(a,b){b.data("oversized")&&c--}),this.scrollPrevControl[b?"removeClass":"addClass"](this.options.hiddenClassName),this.scrollNextControl[c?"removeClass":"addClass"](this.options.hiddenClassName)},onResize:function(){var b,c=this.contentStripe.width();if(c!==this.prevViewportWidth){for(this.slideItems.each(function(b,d){var e=a(d);e.data("oversized",e.data("cwidth")>c),e.data("visibleWidth",e.data("oversized")?0:e.data("cwidth")),e.data("oversized")&&e.hide(this.options.duration)}.bind(this)),this.visibleWidth=0,this.sections[1]=[],this.sections[2]=[],this.slideItems.each(function(b,d){if(b>=this.sections[0].length){var e=a(d);this.visibleWidth+e.data("visibleWidth")<c?(this.sections[1].push(e),e.data("oversized")||e.show(this.options.duration),this.visibleWidth+=e.data("visibleWidth")):(this.sections[2].push(e),e.hide(this.options.duration))}}.bind(this)),b=this.sections[0][this.sections[0].length-1];this.sections[0].length&&this.visibleWidth+b.data("visibleWidth")<=c;)b.data("oversized")||b.show(this.options.duration),this.visibleWidth+=b.data("visibleWidth"),this.sections[1].unshift(this.sections[0].pop()),b=this.sections[0][this.sections[0].length-1];this.afterScroll(),this.viewportWidth=c,this.prevViewportWidth=c}}})}(jQuery);